## Chapter3 ìŠ¤í”„ë§DI

### ì˜ì¡´ì´ë€?
> í•œ í´ë˜ìŠ¤ê°€ ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•  ë•Œ ì´ë¥¼ 'ì˜ì¡´'í•œë‹¤ê³  í‘œí˜„í•œë‹¤.

```java
package spring;

import java.time.LocalDateTime;

public class MemberRegisterService {
    private MemberDao memberDao = new MemberDao();

    public Long regist(RegisterRequest req) {
        Member member = memberDao.selectByEmail(req.getEmail());
        if (member != null) {
            throw new DuplicateMemberException("dup email " + req.getEmail());
        }
        Member newMember = new Member(
                req.getEmail(), req.getPassword(), req.getName(),
                LocalDateTime.now());
        memberDao.insert(newMember);
        return newMember.getId();
    }
}
```

 - ìœ„ì™€ ê°™ì€ MemberRegisterServiceí´ë˜ìŠ¤ì—ì„œ MemberDaoí´ë˜ìŠ¤ì˜ ë©”ì„œë“œì¸ selectByEmailë“±ì„ ì‚¬ìš©í•œë‹¤.
 - MemberRegisterServiceí´ë˜ìŠ¤ê°€ MemberDaoí´ë˜ìŠ¤ì— ì˜ì¡´í•œë‹¤ê³  í•  ìˆ˜ ìˆë‹¤.
 - ì˜ì¡´ì€ ë³€ê²½ì— ì˜í•´ ì˜í–¥ì„ ë°›ëŠ” ê´€ê³„ì´ë‹¤.
 - MemberDaoí´ë˜ìŠ¤ì˜ ë©”ì„œë“œê°€ ë³€ê²½ë˜ë©´ MemberRegisterServiceí´ë˜ìŠ¤ì—ë„ ì˜í–¥ì„ ì¤„ ìˆ˜ìˆë‹¤.
 - MemberRegisterServiceí´ë˜ìŠ¤ì— ì˜ì¡´í•˜ëŠ” MemberDaoê°ì²´ë¥¼ ìƒì„±í•˜ë©´, ì´í›„ì— MemberRegisterServiceê°ì²´ë¥¼ ìƒì„±í• ë•Œ ì˜ì¡´í•˜ëŠ” MemberDaoê°ì²´ë„ í•¨ê»˜ ìƒì„±ë  ìˆ˜ ìˆë‹¤.
 - ìœ ì§€ë³´ìˆ˜í•  ë•Œ ì˜ì¡´ì„±ì— ëŒ€í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

### DIë¥¼ í†µí•œ ì˜ì¡´ ì²˜ë¦¬
> DI = Dependency Injection = ì˜ì¡´ ì£¼ì… : ì˜ì¡´í•˜ëŠ” ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•˜ëŠ” ëŒ€ì‹  ì˜ì¡´ ê°ì²´ë¥¼ ì „ë‹¬ ë°›ëŠ” ë°©ì‹ì´ë‹¤.

![image](https://user-images.githubusercontent.com/55322459/176185225-f7cfacc3-bb9a-4e93-9fa6-219447f479d4.png)

```java
package spring;

import java.time.LocalDateTime;

public class MemberRegisterService {
	private MemberDao memberDao;

	public MemberRegisterService(MemberDao memberDao) {
		this.memberDao = memberDao;
	}

	public Long regist(RegisterRequest req) {
		Member member = memberDao.selectByEmail(req.getEmail());
		if (member != null) {
			throw new DuplicateMemberException("dup email " + req.getEmail());
		}
		Member newMember = new Member(
				req.getEmail(), req.getPassword(), req.getName(), 
				LocalDateTime.now());
		memberDao.insert(newMember);
		return newMember.getId();
	}
}
```
 - ìœ„ì˜ ì½”ë“œì™€ ê°™ì´ ì˜ì¡´ ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•˜ì§€ ì•Šê³ , ìƒì„±ìë¥¼ í†µí•´ ì˜ì¡´ ê°ì²´ë¥¼ ì „ë‹¬ë°›ì•˜ê¸° ë•Œë¬¸ì—, DIíŒ¨í„´ì„ ì‚¬ìš©í•œë‹¤ê³  í•  ìˆ˜ ìˆë‹¤.
 - DIë¥¼ ì‚¬ìš©í•˜ë©´ ìœ ì§€ë³´ìˆ˜ì˜ ìš©ì´ì„±ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

### DIì™€ ì˜ì¡´ ê°ì²´ ë³€ê²½ì˜ ìœ ì—°í•¨
> DIë¥¼ ì‚¬ìš©í•˜ë©´ Aê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ê°€ ì„¸ ê°œì—¬ë„ ë³€ê²½í•  ê³³ì€ ì˜ì¡´ ì£¼ì… ëŒ€ìƒì´ ë˜ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œ í•œ ê³³ ë¿ì´ë‹¤.
> 
> ì˜ì¡´ ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í–ˆë˜ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ ë³€ê²½í•  ì½”ë“œê°€ ì˜ì¡´í•˜ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê³³ë§ˆë‹¤ ë³€ê²½í•´ì£¼ì–´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤.

#### DIì˜ ë³€ê²½ì˜ ìœ ì—°í•¨ ì˜ˆì‹œ
íšŒì›ì •ë³´ì— ìºì‹œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´, MemberDaoí´ë˜ìŠ¤ì— ìƒì†ë°›ì€ CachedMemberDaoí´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì—ˆë‹¤.
ê¸°ì¡´ì˜ MemberDaoê°ì²´ë¥¼ CachedMemberDaoë¡œ ë³€ê²½í•´ì•¼ í•˜ëŠ” ìƒí™©

#### âŒ ì˜ì¡´ ì£¼ì… í•˜ì§€ì•Šì€ ê²½ìš°, ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•˜ëŠ” ê²½ìš°ì˜ ë³€ê²½

â” ë³€ê²½ ì „
```java
public class MemberRegisterService {
    private MemberDao memberDao = new MemberDao();
    ...
}

public class ChangePasswordService {
    prviate MemberDao memberDao = new MemberDao();
    ...
}
```
â• ë³€ê²½ í›„
```java
public class MemberRegisterService {
    private MemberDao memberDao = new CachedMemberDao();
    ...
}

public class ChangePasswordService {
    prviate MemberDao memberDao = new CachedMemberDao();
    ...
}
```
 - ìƒì„±í•˜ëŠ” ê°ì²´ë§ˆë‹¤ ì „ë¶€ ìƒˆë¡­ê²Œ ì¶”ê°€ëœ í´ë˜ìŠ¤ëª…ì„ ë³€ê²½í•´ì¤˜ì•¼í•œë‹¤.
 - ë§¤ìš° ë²ˆê±°ë¡­ë‹¤..

#### â­• ì˜ì¡´ì£¼ì…ì„ í•œ ê²½ìš°ì˜ ë³€ê²½, ê°ì²´ë¥¼ ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ í†µí•´ì„œ ì£¼ì…í•˜ëŠ” ê²½ìš°ì˜ ë³€ê²½

â” ë³€ê²½ ì „
```java
MemberDao memberDao = new MemberDao();
MemberRegisterService rgSc = new MemberRegisterService(memberDao);
ChangePasswordService pwSc = new ChangePasswordService(memberDao);
```
â• ë³€ê²½ í›„
```java
MemberDao memberDao = new CachedMemberDao();
MemberRegisterService rgSc = new MemberRegisterService(memberDao);
ChangePasswordService pwSc = new ChangePasswordService(memberDao);
```
- ì˜ì¡´ ì£¼ì…ì˜ ëŒ€ìƒì´ë˜ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê³³ì—ì„œë§Œ ë³€ê²½ í•´ì£¼ë©´ëœë‹¤.
- ì´ì „ì˜ ì§ì ‘ ê°ì²´ ìƒì„±í•˜ëŠ” ë°©ì‹ì´ë¼ë©´, MemberRegisterServiceí´ë˜ìŠ¤, ...ë“± ëª¨ë“  ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ì—ì„œ ìƒì„±í• ë•Œë§ˆë‹¤ ë³€ê²½í•´ì£¼ì–´ì•¼í•œë‹¤.
- ìƒì„±ìë¥¼ í†µí•´ ê°ì²´ë¥¼ ì£¼ì…í•˜ê¸° ë•Œë¬¸ì— ì˜ì¡´í•˜ëŠ” ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ìƒí™©ì—ì„œë§Œ ìƒì„±ìë¥¼ ìƒì„±í•˜ë©´ì„œ ì£¼ì…í•˜ë©´ëœë‹¤!

### ê°ì²´ ì¡°ë¦½ê¸°(assembler)
> ì˜ì¡´ ê°ì²´ë¥¼ ì£¼ì…í•œë‹¤ëŠ” ê²ƒì€ ì„œë¡œ ë‹¤ë¥¸ ë‘ ê°ì²´ë¥¼ ì¡°ë¦½í•œë‹¤ê³  ìƒê°í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŸ° ì˜ë¯¸ì—ì„œ ì´ í´ë˜ìŠ¤ë¥¼
> ì¡°ë¦½ê¸°ë¼ê³ ë„ í‘œí˜„í•œë‹¤.

```java
package assembler;

import spring.ChangePasswordService;
import spring.MemberDao;
import spring.MemberRegisterService;

public class Assembler {

	private MemberDao memberDao;
	private MemberRegisterService regSvc;
	private ChangePasswordService pwdSvc;

	public Assembler() {
		memberDao = new MemberDao();
		regSvc = new MemberRegisterService(memberDao);
		pwdSvc = new ChangePasswordService();
		pwdSvc.setMemberDao(memberDao);
	}

	public MemberDao getMemberDao() {
		return memberDao;
	}

	public MemberRegisterService getMemberRegisterService() {
		return regSvc;
	}

	public ChangePasswordService getChangePasswordService() {
		return pwdSvc;
	}

}
```
 - Assembler í´ë˜ìŠ¤ì—ì„œ Assemblerê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
 - MemberRegisterService í´ë˜ìŠ¤ëŠ” ìƒì„±ìë¥¼ í†µí•´, ChangePasswordService í´ë˜ìŠ¤ëŠ” setterë¥¼ í†µí•´ì„œ ê°ì²´ë¥¼ ì£¼ì…í•œë‹¤.

ì´ì „ì— í•™ìŠµí•œ ë‚´ìš©ì²˜ëŸ¼ MemberDaoí´ë˜ìŠ¤ê°€ ì•„ë‹ˆë¼ MemberDao í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” CachedMemberDaoí´ë˜ìŠ¤ë¥¼
ì‚¬ìš©í•œë‹¤ë©´ Assemblerí´ë˜ìŠ¤ì—ì„œ ê°ì²´ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì½”ë“œë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤.

### ìŠ¤í”„ë§ì˜ DI ì„¤ì •
> ìŠ¤í”„ë§ì€ Assembler í´ë˜ìŠ¤ì˜ ìƒì„±ì ì½”ë“œ ì²˜ëŸ¼ í•„ìš”í•œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ ,
> ìƒì„±í•œ ê°ì²´ì— ì˜ì¡´ì„ ì£¼ì…í•œë‹¤.
> ë˜í•œ ìŠ¤í”„ë§ì€ Assembler#getMemberRegisterService() ë©”ì„œë“œì²˜ëŸ¼ ê°ì²´ë¥¼ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì •ì˜í•˜ê³ ìˆë‹¤.
> ì°¨ì´ì ì´ë¼ë©´ AssemblerëŠ” MemberRegisterServiceë‚˜ MemberDaoì™€ ê°™ì´ íŠ¹ì • íƒ€ì…ì˜ í´ë˜ìŠ¤ë§Œ ìƒì„±í•œ ë°˜ë©´ ìŠ¤í”„ë§ì€ ë²”ìš© ì¡°ë¦½ê¸°ë¼ëŠ” ì ì´ë‹¤.

#### ìŠ¤í”„ë§ì„ ì´ìš©í•œ ê°ì²´ ì¡°ë¦½ê³¼ ì‚¬ìš©
```java
package config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import spring.ChangePasswordService;
import spring.MemberDao;
import spring.MemberRegisterService;

@Configuration
public class AppCtx {
    public AppCtx() {
    }

    @Bean
    public MemberDao memberDao() {
        return new MemberDao();
    }

    @Bean
    public MemberRegisterService memberRegSvc() {
        return new MemberRegisterService(this.memberDao());
    }

    @Bean
    public ChangePasswordService changePwdSvc() {
        ChangePasswordService pwdSvc = new ChangePasswordService();
        pwdSvc.setMemberDao(this.memberDao());
        return pwdSvc;
    }
}
```
- @Configuration ì• ë…¸í…Œì´ì…˜ì€ ìŠ¤í”„ë§ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ì˜ë¯¸í•œë‹¤.
- ì´ ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì•¼ ìŠ¤í”„ë§ ì„¤ì • í´ë˜ìŠ¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- @Bean ì• ë…¸í…Œì´ì…˜ì€ í•´ë‹¹ ë©”ì„œë“œê°€ ìƒì„±í•œ ê°ì²´ë¥¼ ìŠ¤í”„ë§ë¹ˆì´ë¼ê³  ì„¤ì •í•œë‹¤.
- @Beanì´ ë¶™ì–´ìˆëŠ” ê°ê°ì˜ ë©”ì„œë“œë§ˆë‹¤ í•œ ê°œì˜ ë¹ˆ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
- ë©”ì„œë“œì˜ ì´ë¦„ì„ ë¹ˆ ê°ì²´ì˜ ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

> ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì˜ì¡´ ê°ì²´ë¥¼ ì£¼ì…í•˜ëŠ” ê²ƒì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì´ë¯€ë¡œ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤.

```java
AbstractApplicationContext ctx = new AnnotationConfigApplicationContext(AppCtx.class);
```

AnnotationConfigApplicationContext í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•œë‹¤.
ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ë©´ getBean()ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ì‚¬ìš©í•  ê°ì²´ë¥¼ êµ¬í•  ìˆ˜ ìˆë‹¤.

```java
MemberRegisterService regSvc = ctx.getBean("memberRegSvc", MemberRegisterService.class);
```
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ(ctx)ë¡œ ë¶€í„° ì´ë¦„ì´ "memberRegSvc"ì¸ ë¹ˆ ê°ì²´ë¥¼ êµ¬í•œë‹¤.
```java
package main;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

import config.AppCtx;
import spring.ChangePasswordService;
import spring.DuplicateMemberException;
import spring.MemberNotFoundException;
import spring.MemberRegisterService;
import spring.RegisterRequest;
import spring.WrongIdPasswordException;

public class MainForSpring {

    private static ApplicationContext ctx = null;

    public static void main(String[] args) throws IOException {
        ctx = new AnnotationConfigApplicationContext(AppCtx.class);

        BufferedReader reader =
                new BufferedReader(new InputStreamReader(System.in));
        while (true) {
            System.out.println("ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            String command = reader.readLine();
            if (command.equalsIgnoreCase("exit")) {
                System.out.println("ì¢…ë£Œí•©ë‹ˆë‹¤.");
                break;
            }
            if (command.startsWith("new ")) {
                processNewCommand(command.split(" "));
                continue;
            } else if (command.startsWith("change ")) {
                processChangeCommand(command.split(" "));
                continue;
            } else if (command.equals("list")) {
                processListCommand();
                continue;
            } else if (command.startsWith("info ")) {
                processInfoCommand(command.split(" "));
                continue;
            } else if (command.equals("version")) {
                processVersionCommand();
                continue;
            }
            printHelp();
        }
    }

    private static void processNewCommand(String[] arg) {
        if (arg.length != 5) {
            printHelp();
            return;
        }
        MemberRegisterService regSvc =
                ctx.getBean("memberRegSvc", MemberRegisterService.class);
        RegisterRequest req = new RegisterRequest();
        req.setEmail(arg[1]);
        req.setName(arg[2]);
        req.setPassword(arg[3]);
        req.setConfirmPassword(arg[4]);

        if (!req.isPasswordEqualToConfirmPassword()) {
            System.out.println("ì•”í˜¸ì™€ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n");
            return;
        }
        try {
            regSvc.regist(req);
            System.out.println("ë“±ë¡í–ˆìŠµë‹ˆë‹¤.\n");
        } catch (DuplicateMemberException e) {
            System.out.println("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.\n");
        }
    }

    private static void processChangeCommand(String[] arg) {
        if (arg.length != 4) {
            printHelp();
            return;
        }
        ChangePasswordService changePwdSvc =
                ctx.getBean("changePwdSvc", ChangePasswordService.class);
        try {
            changePwdSvc.changePassword(arg[1], arg[2], arg[3]);
            System.out.println("ì•”í˜¸ë¥¼ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.\n");
        } catch (MemberNotFoundException e) {
            System.out.println("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.\n");
        } catch (WrongIdPasswordException e) {
            System.out.println("ì´ë©”ì¼ê³¼ ì•”í˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n");
        }
    }
    
    ... printHelp ìƒëµ
}
```
- import org.springframework.context.ApplicationContext;
  import org.springframework.context.annotation.AnnotationConfigApplicationContext; ë¶€ë¶„ì´ ì„í¬íŠ¸ ë˜ì—ˆë‹¤.
- ê¸°ì¡´ì˜ Assembler í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ê°ì²´ë¥¼ í•œë²ˆì— ì¡°ë¦½í•´ì„œ ì£¼ì…í•˜ëŠ” ë°©ì‹ì—ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½
#### ë³€ê²½ëœ ë¶€ë¶„
- ctx = new AnnotationConfigApplicationContext(AppCtx.class);
  - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„± = Assemblerì™€ ë™ì¼í•˜ê²Œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì˜ì¡´ ê°ì²´ë¥¼ ì£¼ì…
- MemberRegisterService regSvc =
   ctx.getBean("memberRegSvc", MemberRegisterService.class);
  - ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆë¡œ ë¶€í„° "memberRegSvc"ì˜ ì´ë¦„ì„ ê°€ì§„ ë¹ˆ ê°ì²´ ìƒì„±
- MemberRegisterService regSvc =
  ctx.getBean("memberRegSvc", MemberRegisterService.class);
  - ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆë¡œ ë¶€í„° "changePwdSvc"ì˜ ì´ë¦„ì„ ê°€ì§„ ë¹ˆ ê°ì²´ ìƒì„±
  

#### âŒ ì—ëŸ¬ëŒ€ì‘
 - NoSuchBeanDefinitionException : @Bean ì„¤ì •ì„ í•´ì£¼ì§€ ì•Šì•˜ì„ ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì´ë‹¤.

#### DI ë°©ì‹ : ìƒì„±ì ë°©ì‹
 - ì˜ì¡´ê°ì²´ë¥¼ ì£¼ì…ë°›ì•„ í•„ë“œì— í• ë‹¹í•´ì¤€ë‹¤. ex) this.memberDao
 - ì „ë‹¬í•  ì˜ì¡´ ê°ì²´ê°€ ë‘ê°œ ì´ìƒë„ ê°€ëŠ¥í•˜ë‹¤.

#### ìƒì„±ì ë°©ì‹ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ
> ğŸ”½ 0. spring/MemberDao.java ì—¬ëŸ¬ê°œì˜ ê°ì²´ê°€ ì£¼ì… ë˜ê¸° ë•Œë¬¸ì— í•œë²ˆì— ì°¾ì•„ë‚´ëŠ” ë©”ì„œë“œë¥¼ ìƒì„±
```java
pulbic class MemberDao {
   
    public Collection<Member> selectAll() {
        return map.value();
    }
    ... ì¶”ê°€ ê¸°ëŠ¥
}
```

> ğŸ”½ 1. spring/testA.java í´ë˜ìŠ¤ë¥¼ ì¶”ê°€(2ê°œì˜ ê°ì²´ë¥¼ ë°›ëŠ” ìƒì„±ì)
```java
pulbic class teatA {
    private MemberDao memberDao;
    private MemberPrinter printer;
    
    public testA(MemberDao memberDao, MemberPrinter printer) {
        this.memberDao = memberDao;
        this.printer = printer;
    }
    ... ì¶”ê°€ ê¸°ëŠ¥
}
```

> ğŸ”½ 2. config/AppCtx.java(ì„¤ì •íŒŒì¼) ë‘ ê°œ ì´ìƒì˜ ì¸ìë¥¼ ë°›ëŠ” ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ëŠ” ì„¤ì • ì¶”ê°€
```java
import spring.testA;

@Bean
public testA listPrinter() {
    return new testA(memberDao(), memberPrinter());//memberDao, memberPrinter ë¹ˆ ì£¼ì…
        }
```
> ğŸ”½ 3. spring/MainForSpring.java(ë©”ì¸) testAê´€ë ¨ ì½”ë“œ ì¶”ê°€
```java
import spring.testA;

private static void testB() {
    testA listPrinter = ctx.getBean("listPringer", testA.class);
        ...ê¸°ëŠ¥ ì‚¬ìš©
        }
```

#### DI ë°©ì‹ : setter ë©”ì„œë“œ ë°©ì‹
 - ì „ë‹¬í•  ì˜ì¡´ ê°ì²´ê°€ 1ê°œì´ë‹¤.
 - ë¦¬í„´ íƒ€ì…ì´ void ì´ë‹¤.

#### setter ë©”ì„œë“œ ë°©ì‹ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ
> ğŸ”½ 1. spring/testB.java setterë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ì˜ì¡´ ê°ì²´ë¥¼ ì£¼ì… ë°›ì„ ë©”ì„œë“œ ì¶”ê°€
```java
pulbic class teatB {
    private MemberDao memberDao;
    private MemberPrinter printer;
    
    public void setMemberDao(MemberDao memberDao) {
        this.memberDao = memberDao;
    }
    public void setPrinter(MemberPrinter printer) {
        this.printer = printer;
    }
    ... ì¶”ê°€ ê¸°ëŠ¥
}
```

> ğŸ”½ 2. config/AppCtx.java(ì„¤ì •íŒŒì¼) setter ë©”ì„œë“œ ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ì„¤ì • ì¶”ê°€
```java
import spring.testB;

@Bean
public testB infoPrinter() {
    testB infoPrinter = new testB();
    infoPrinter.setMemberDao(memberDao());//memberDao ë¹ˆ ì£¼ì…
    infoPrinter.setPrinter(memberPrinter());//memberPrinter ë¹ˆ ì£¼ì…
    return infoPrinter;
        }
```
> ğŸ”½ 3. spring/MainForSpring.java(ë©”ì¸) testAê´€ë ¨ ì½”ë“œ ì¶”ê°€
```java
import spring.testB;

private static void testB() {
    testB infoPrinter = ctx.getBean("infoPrinter", testB.class);
        ...ê¸°ëŠ¥ ì‚¬ìš©
        }
```

#### ìƒì„±ì vs setter ë©”ì„œë“œ ë°©ì‹ì˜ ê°ì²´ ì£¼ì… ì°¨ì´ì 
 - ìƒì„±ì ë°©ì‹ : ë¹ˆ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì‹œì ì— ëª¨ë“  ì˜ì¡´ ê°ì²´ê°€ ì£¼ì…ëœë‹¤.
 - setter ë©”ì„œë“œ ë°©ì‹ : setter ë©”ì„œë“œ ì´ë¦„ì„ í†µí•´ ì–´ë–¤ ì˜ì¡´ ê°ì²´ê°€ ì£¼ì…ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.

> ìƒì„±ì ë°©ì‹ì€ ì–´ë–¤ ì˜ì¡´ ê°ì²´ë¥¼ ì„¤ì •í•˜ëŠ”ì§€ ì•Œì•„ë‚´ë ¤ë©´ ìƒì„±ìì˜ ì½”ë“œë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ setter ë©”ì„œë“œ ë°©ì‹ì€
ë©”ì„œë“œì˜ ì´ë¦„ìœ¼ë¡œ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤.
ë°˜ë©´ì— ìƒì„±ì ë°©ì‹ì€ ë¹ˆ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì‹œì ì— í•„ìš”í•œ ëª¨ë“  ì˜ì¡´ ê°ì²´ë¥¼ ì£¼ì… ë°›ê¸° ë•Œë¬¸ì— ê°ì²´ë¥¼ ì‚¬ìš©í•  ë•Œ ì™„ì „í•œ ìƒíƒœë¡œ
ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. setterë©”ì„œë“œ ë°©ì‹ì€ setterë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ í•„ìš”í•œ ì˜ì¡´ ê°ì²´ë¥¼ ì „ë‹¬ í•˜ì§€ ì•Šì•„ë„ ë¹ˆ ê°ì²´ê°€ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹œì ì—ì„œ 
NullPointerExceptionì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

### @Configuration ì„¤ì • í´ë˜ìŠ¤ì˜ @Bean ì„¤ì •ê³¼ ì‹±ê¸€í†¤
> ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìƒì„±í•œ ë¹ˆì€ ì‹±ê¸€í†¤ ê°ì²´ì´ë‹¤.
> ë‹¤ë¥¸ ì„¤ì • ë©”ì„œë“œì—ì„œ memberDao()ë¥¼ ëª‡ ë²ˆ í˜¸ì¶œí•˜ë”ë¼ë„ í•­ìƒ ê°™ì€ ê°ì²´ë¥¼ ë¦¬í„´í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

```java
@Configuration//ì¤‘ë³µëœ memberDao()ë¥¼ í˜¸ì¶œí•˜ëŠ” ì˜ˆì‹œ
public class AppCtx {

  @Bean
  public MemberDao memberDao() {
    return new MemberDao();
  }

  @Bean
  public MemberRegisterService memberRegSvc() {
    return new MemberRegisterService(memberDao());
  }

  @Bean
  public ChangePasswordService changePwdSvc() {
    ChangePasswordService pwdSvc = new ChangePasswordService();
    pwdSvc.setMemberDao(memberDao());
    return pwdSvc;
  }
}
```
```java
public class AppCtxExt extends AppCtx {//ìŠ¤í”„ë§ ëŸ°íƒ€ì„ì— ìƒì„±í•œ ì„¤ì • í´ë˜ìŠ¤ ì˜ˆì‹œ
    
    private Map<String, Object> beans = ...;
    
    @Override
    public MemberDao memberDao() {
        if(!beans.containsKey("memberDao"))
            beans.put("memberDao", super.memberDao());
        
        return (MemberDao) beans.get("memberDao");
    }
}
```
- ìŠ¤í”„ë§ ëŸ°íƒ€ì„ì— ìƒì„±í•œ ì„¤ì • í´ë˜ìŠ¤ì˜ memberDao() ë©”ì„œë“œëŠ” ë§¤ë²ˆ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.
- í•œ ë²ˆ ìƒì„±í•œ ê°ì²´ë¥¼ ë³´ê´€í–ˆë‹¤ê°€ ì´í›„ì—ëŠ” ë™ì¼í•œ ê°ì²´ë¥¼ ë¦¬í„´í•œë‹¤.
- ë”°ë¼ì„œ memberRegSvc(), changePwdSvc()ë©”ì„œë“œì—ì„œ memberDao() ë©”ì„œë“œë¥¼ ê°ê° ì‹¤í–‰í•´ë„ ë™ì¼í•œ MemberDao ê°ì²´ë¥¼ ì‚¬ìš©í•œë‹¤.

### ë‘ ê°œ ì´ìƒì˜ ì„¤ì • íŒŒì¼ ì‚¬ìš©í•˜ê¸°

```java
package config; //AppCtx.javaì˜ ë¹ˆ ì„¤ì •ì„ ë‚˜ëˆ ì„œ í•œë‹¤.

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import spring.MemberDao;
import spring.MemberPrinter;

@Configuration
public class AppConf1 {
    //ìƒì„±ì , setter ë©”ì„œë“œ ë°©ì‹ìœ¼ë¡œ ë¹ˆê°ì²´ë¥¼ ì£¼ì…í•˜ì§€ ì•Šì•˜ë‹¤.
	@Bean
	public MemberDao memberDao() {
		return new MemberDao();
	}
	
	@Bean
	public MemberPrinter memberPrinter() {
		return new MemberPrinter();
	}
	
}
```

```java
package config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import spring.ChangePasswordService;
import spring.MemberDao;
import spring.MemberInfoPrinter;
import spring.MemberListPrinter;
import spring.MemberPrinter;
import spring.MemberRegisterService;
import spring.VersionPrinter;

@Configuration
public class AppConf2 {
    //@Autowired ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ë¹ˆê°ì²´ë¥¼ ì£¼ì…í•œë‹¤.
	@Autowired
	private MemberDao memberDao;
	@Autowired
	private MemberPrinter memberPrinter;
	
	@Bean
	public MemberRegisterService memberRegSvc() {
		return new MemberRegisterService(memberDao);
	}
	
	@Bean
	public ChangePasswordService changePwdSvc() {
		ChangePasswordService pwdSvc = new ChangePasswordService();
		pwdSvc.setMemberDao(memberDao);
		return pwdSvc;
	}
	
	@Bean
	public MemberListPrinter listPrinter() {
		return new MemberListPrinter(memberDao, memberPrinter);
	}
	
	@Bean
	public MemberInfoPrinter infoPrinter() {
		MemberInfoPrinter infoPrinter = new MemberInfoPrinter();
		infoPrinter.setMemberDao(memberDao);
		infoPrinter.setPrinter(memberPrinter);
		return infoPrinter;
	}
	
	@Bean
	public VersionPrinter versionPrinter() {
		VersionPrinter versionPrinter = new VersionPrinter();
		versionPrinter.setMajorVersion(5);
		versionPrinter.setMinorVersion(0);
		return versionPrinter;
	}
}
```

 - @Autowired ì• ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ ìŠ¤í”„ë§ì˜ ìë™ ì£¼ì… ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.
 - @Autowired ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ í•´ë‹¹ íƒ€ì…ì˜ ë¹ˆì„ ì°¾ì•„ì„œ í•„ë“œì— í• ë‹¹í•œë‹¤.
 - ìœ„ ì„¤ì •ì˜ ê²½ìš° ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” MemberDao íƒ€ì…ì˜ ë¹ˆì„ memberDao í•„ë“œì— í• ë‹¹í•œë‹¤.

> AppConf1 í´ë˜ìŠ¤ì—ì„œ MemberDao íƒ€ì…ì˜ ë¹ˆì„ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ AppConf2 í´ë˜ìŠ¤ì˜ memberDao í•„ë“œì—ëŠ”
> AppConf1 í´ë˜ìŠ¤ì—ì„œ ì„¤ì •í•œ ë¹ˆì´ í• ë‹¹ëœë‹¤.

#### ì„¤ì •íŒŒì¼ì´ 2ê°œ ì´ê¸° ë•Œë¬¸ì— ì»¨í…Œì´ë„ˆ ìƒì„±í•˜ëŠ” ì½”ë“œì—ë„ íŒŒë¼ë¯¸í„°ê°€ 2ê°œì´ë‹¤.
```java
ctx = new AnnotationConfigApplicationContext(AppConf1.class, AppConf2.class );
```

#### @Configuration ì• ë…¸í…Œì´ì…˜, ë¹ˆ, @Autowired ì• ë…¸í…Œì´ì…˜
> @Autowried ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì´ê²Œë˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì„¤ì • íŒŒì¼ì¸ @Configurationì´ ë¶™ì–´ìˆëŠ” @Beanê°ì²´ì—ì„œ
> ìƒì„±ì ì£¼ì…, setter ë©”ì„œë“œ ë°©ì‹ ì£¼ì…ìœ¼ë¡œ ê°ì²´ë¥¼ ì£¼ì…í•˜ì§€ì•Šì•„ë„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì•Œì•„ì„œ ê°ì²´ë¥¼ ì£¼ì…í•œë‹¤.

### getBean() ë©”ì„œë“œ ì‚¬ìš©
 - getBean() ë©”ì„œë“œì˜ ì²« ë²ˆì§¸ ì¸ìëŠ” ë¹ˆì˜ ì´ë¦„ì´ê³ , ë‘ ë²ˆì§¸ ì¸ìëŠ” ë¹ˆì˜ íƒ€ì…ì´ë‹¤. 
 - í•´ë‹¹ íƒ€ì…ì˜ ë¹ˆ ê°ì²´ê°€ í•œê°œë§Œ ì¡´ì¬í•˜ë©´ ë¹ˆ ê°ì²´ì˜ ì´ë¦„ì€ ìƒëµ ê°€ëŠ¥í•˜ë‹¤. 
 - í•´ë‹¹ íƒ€ì…ì— ë¹ˆ ê°ì²´ê°€ 2ê°œ ì´ìƒì´ë¼ë©´ "NoSuchBeanDefinitionException" ì´ ë°œìƒí•œë‹¤.
```java
VersionPrinter versionPrinter =  ctx.getBean("versionPrinter", VersionPrinter.class);
```
```java
// VersionPrinter.class ì˜ ë¹ˆ ê°ì²´ê°€ í•œê°œë§Œ ì¡´ì¬í•˜ëŠ” ê²½ìš° ë¹ˆ ê°ì²´ì˜ ì´ë¦„ ìƒëµ ë²„ì „
VersionPrinter versionPrinter =  ctx.getBean(VersionPrinter.class);
```

#### âŒ ê°™ì€ íƒ€ì…ì˜ 2ê°œì˜ ë¹ˆê°ì²´ ìƒì„± ì˜ˆì‹œ ì´ëŸ° ê²½ìš° ë¹ˆ ê°ì²´ëª…ì„ ìƒëµí•˜ë©´ ì—ëŸ¬ë°œìƒ
```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import spring.VersionPrinter;

@Configuration
public class AppCtx4GetBean {
  private MemberPrinter printer = new MemberPrinter();

  @Bean//versionPrinter ë¹ˆ ê°ì²´, VersionPrinter íƒ€ì…
  public VersionPrinter versionPrinter() {// VersionPrinterë¼ëŠ” íƒ€ì…ì˜ ë¹ˆ ê°ì²´ë¥¼ 2ê°œ ìƒì„±
    VersionPrinter versionPrinter = new VersionPrinter();
    versionPrinter.setMajorVersion(5);
    versionPrinter.setMinorVersion(0);
    return versionPrinter;
  }

  @Bean//oldVersionPrinter ë¹ˆ ê°ì²´, VersionPrinter íƒ€ì…
  public VersionPrinter oldVersionPrinter() {
    VersionPrinter versionPrinter = new VersionPrinter();
    versionPrinter.setMajorVersion(4);
    versionPrinter.setMinorVersion(3);
    return versionPrinter;
  }
}
```

### ì£¼ì… ëŒ€ìƒ ê°ì²´ë¥¼ ëª¨ë‘ ë¹ˆ ê°ì²´ë¡œ ì„¤ì •í•´ì•¼ í•˜ë‚˜?
- ê°ì²´ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ë•Œì™€ ë“±ë¡í•˜ì§€ ì•Šì•˜ì„ ë•Œì˜ ì°¨ì´ëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ê°ì²´ë¥¼ ê´€ë¦¬í•˜ëŠ”ì§€ ì—¬ë¶€ì´ë‹¤.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìë™ ì£¼ì…, ë¼ì´í”Œ ì‚¬ì´í´ ê´€ë¦¬ ë“± ë‹¨ìˆœ ê°ì²´ ìƒì„± ì™¸ì— ê°ì²´ ê´€ë¦¬ë¥¼ ìœ„í•œ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë° ë¹ˆìœ¼ë¡œ ë“±ë¡í•œ ê°ì²´ì—ë§Œ ê¸°ëŠ¥ì„ ì ìš©í•œë‹¤. 
- ì¦‰, ë°˜ë“œì‹œ ì£¼ì…í•  ê°ì²´ê°€ ë¹ˆì¼ í•„ìš”ëŠ” ì—†ì§€ë§Œ, ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìƒì„± ì´í›„ì— ê´€ë¦¬ë¥¼ ì§ì ‘ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤. 
- getBean()ì„ ì´ìš©í•´ì„œ ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤.
- __ì£¼ì… ëŒ€ìƒì˜ ê°ì²´ëŠ” ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ”ê²ƒì´ í¸ë¦¬í•˜ë‹¤.__

#### ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šì€ ê°ì²´ë¥¼ ì£¼ì…í•˜ëŠ” ì˜ˆì‹œ
```java
package config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import spring.MemberDao;
import spring.MemberInfoPrinter;
import spring.MemberPrinter;

@Configuration
public class AppCtxNoMemberPrinterBean {
  private MemberPrinter printer = new MemberPrinter(); // ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì£¼ ìºì€ ê°ì²´

  @Bean
  public MemberDao memberDao() {
    return new MemberDao();
  }

  @Bean
  public MemberInfoPrinter infoPrinter() {
    MemberInfoPrinter infoPrinter = new MemberInfoPrinter();
    infoPrinter.setMemberDao(memberDao());
    infoPrinter.setPrinter(printer);
    return infoPrinter;
  }
}
```
